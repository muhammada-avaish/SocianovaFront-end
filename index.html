<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SociaNova - Twitter Clone</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .fade { transition: all 0.3s ease-in-out; opacity: 0; height: 0; overflow: hidden; }
  .fade.show { opacity: 1; height: auto; }
  ::placeholder { color: #a0aec0; }
</style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

<!-- Navbar -->
<nav class="bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-10">
  <h1 class="text-xl font-bold text-blue-500">SociaNova</h1>
  <div id="nav-links" class="hidden space-x-4">
    <button onclick="goTo('feed-page')" class="px-3 py-1 hover:bg-blue-100 rounded">Feed</button>
    <button onclick="goTo('messages-page')" class="px-3 py-1 hover:bg-blue-100 rounded">Messages</button>
    <button onclick="goTo('profile-page')" class="px-3 py-1 hover:bg-blue-100 rounded">Profile</button>
    <button onclick="logout()" class="px-3 py-1 hover:bg-red-100 rounded text-red-500">Logout</button>
  </div>
</nav>

<div class="max-w-2xl mx-auto p-4 flex-grow">

  <!-- ===== Auth Page ===== -->
  <div id="auth-page" class="fade show">
    <div class="text-center mb-6">
      <h2 class="text-3xl font-bold text-gray-700">Welcome to SociaNova</h2>
      <p class="text-gray-500 mt-1">Login or Signup to continue</p>
    </div>
    <div class="flex justify-center gap-4 mb-4">
      <button onclick="toggleAuth('login')" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:shadow-md transition">Login</button>
      <button onclick="toggleAuth('signup')" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:shadow-md transition">Signup</button>
    </div>

    <!-- Login -->
    <div id="login-form" class="fade show flex flex-col gap-2">
      <input id="login-username" placeholder="Username" class="w-full border p-2 rounded-lg">
      <input id="login-password" type="password" placeholder="Password" class="w-full border p-2 rounded-lg">
      <button onclick="login()" class="bg-blue-500 w-full py-2 text-white rounded-lg hover:shadow-md mt-2">Login</button>
    </div>

    <!-- Signup -->
    <div id="signup-form" class="fade flex flex-col gap-2">
      <input id="signup-username" placeholder="Username" class="w-full border p-2 rounded-lg">
      <input id="signup-password" type="password" placeholder="Password" class="w-full border p-2 rounded-lg">
      <button onclick="signup()" class="bg-green-500 w-full py-2 text-white rounded-lg hover:shadow-md mt-2">Signup</button>
    </div>
  </div>

  <!-- ===== Feed ===== -->
  <div id="feed-page" class="fade">
    <div class="flex flex-col gap-2 mb-4">
      <textarea id="post-content" placeholder="What's happening?" class="w-full border p-2 rounded-lg"></textarea>
      <button onclick="createPost()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:shadow-md">Post</button>
    </div>
    <div id="posts" class="space-y-4"></div>
  </div>

  <!-- ===== Messages ===== -->
  <div id="messages-page" class="fade">
    <h2 class="text-xl font-bold mb-2 text-gray-700">Messages</h2>
    <input id="receiver" placeholder="Receiver username" class="w-full border p-2 rounded-lg mb-2">
    <textarea id="message-text" placeholder="Type your message..." class="w-full border p-2 rounded-lg mb-2"></textarea>
    <button onclick="sendMessage()" class="bg-blue-500 text-white px-4 py-2 rounded-lg mb-4 hover:shadow-md">Send</button>
    <div id="messages" class="space-y-2"></div>
  </div>

  <!-- ===== Profile ===== -->
  <div id="profile-page" class="fade">
    <h2 class="text-xl font-bold mb-2 text-gray-700">Edit Profile</h2>
    <input id="profile-username" placeholder="New Username" class="w-full border p-2 rounded-lg mb-2">
    <input id="profile-password" type="password" placeholder="New Password" class="w-full border p-2 rounded-lg mb-2">
    <button onclick="updateProfile()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:shadow-md mb-4">Update</button>
  </div>

</div>

<footer class="bg-gray-200 text-center py-3 text-sm text-gray-600">
  Made with ❤️ by <strong>BloxStudios</strong> | Muhammad Ahmad
</footer>

<script>
const API_URL = "https://socianova.onrender.com/api";
let token = localStorage.getItem("token");

// Page Handling
function show(pageId){
  document.querySelectorAll("#auth-page, #feed-page, #messages-page, #profile-page").forEach(p=>p.classList.remove("show"));
  document.getElementById(pageId).classList.add("show");
  if(pageId!=="auth-page") document.getElementById("nav-links").classList.remove("hidden");
}

// Toggle login/signup forms
function toggleAuth(form){
  document.getElementById("login-form").classList.remove("show");
  document.getElementById("signup-form").classList.remove("show");
  document.getElementById(form+"-form").classList.add("show");
}

// Auth
async function signup(){
  const username = document.getElementById("signup-username").value.trim();
  const password = document.getElementById("signup-password").value.trim();
  if(!username||!password) return alert("Fill all fields");

  const res = await fetch(`${API_URL}/auth/register`, { // correct endpoint
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({username,password})
  });

  if(res.ok){ alert("Signup successful! Please login."); toggleAuth('login'); }
  else{ const data = await res.json(); alert(data.message||"Signup failed"); }
}

async function login(){
  const username = document.getElementById("login-username").value.trim();
  const password = document.getElementById("login-password").value.trim();
  if(!username||!password) return alert("Fill all fields");

  const res = await fetch(`${API_URL}/auth/login`, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({username,password})
  });

  const data = await res.json();
  if(res.ok){
    token = data.token;
    localStorage.setItem("token", token);
    loadPosts();
    show("feed-page");
  } else alert(data.message||"Login failed");
}

function logout(){
  token = null;
  localStorage.removeItem("token");
  show("auth-page");
  document.getElementById("nav-links").classList.add("hidden");
}

// Posts
async function createPost(){
  const content = document.getElementById("post-content").value.trim();
  if(!content) return;
  const res = await fetch(`${API_URL}/posts`, {
    method:"POST",
    headers:{"Content-Type":"application/json","Authorization":`Bearer ${token}`},
    body:JSON.stringify({content})
  });
  if(res.ok){ document.getElementById("post-content").value=""; loadPosts(); }
}

async function loadPosts(){
  const res = await fetch(`${API_URL}/posts`, { headers:{"Authorization":`Bearer ${token}`} });
  if(res.status===401){ logout(); return; }
  const posts = await res.json();
  document.getElementById("posts").innerHTML = posts.map(p=>`
    <div class="border p-3 rounded-lg bg-white shadow hover:shadow-md transition">
      <strong>${p.author}</strong>: ${p.content}
    </div>
  `).join("");
}

// Messages
async function sendMessage(){
  const receiver = document.getElementById("receiver").value.trim();
  const text = document.getElementById("message-text").value.trim();
  if(!receiver||!text) return;
  const res = await fetch(`${API_URL}/messages`, {
    method:"POST",
    headers:{"Content-Type":"application/json","Authorization":`Bearer ${token}`},
    body:JSON.stringify({receiver,text})
  });
  if(res.ok){ document.getElementById("message-text").value=""; loadMessages(); }
}

async function loadMessages(){
  const res = await fetch(`${API_URL}/messages`, { headers:{"Authorization":`Bearer ${token}`} });
  if(res.status===401){ logout(); return; }
  const msgs = await res.json();
  document.getElementById("messages").innerHTML = msgs.map(m=>`
    <div class="border p-2 rounded-lg bg-white shadow">${m.sender}: ${m.text}</div>
  `).join("");
}

// Profile
async function loadProfile(){
  const res = await fetch(`${API_URL}/auth/me`, { headers:{"Authorization":`Bearer ${token}`} });
  if(res.ok){
    const data = await res.json();
    document.getElementById("profile-username").value = data.username||"";
  }
}

async function updateProfile(){
  const username = document.getElementById("profile-username").value.trim();
  const password = document.getElementById("profile-password").value.trim();
  if(!username && !password) return alert("Fill at least one field");

  const res = await fetch(`${API_URL}/auth/update`, {
    method:"PUT",
    headers:{"Content-Type":"application/json","Authorization":`Bearer ${token}`},
    body:JSON.stringify({username,password})
  });
  if(res.ok) alert("Profile updated!");
  else alert("Update failed");
}

// Auto login
if(token){ loadPosts(); show("feed-page"); } 
else show("auth-page");
</script>
</body>
</html>
